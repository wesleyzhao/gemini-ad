(function(){'use strict';const CONFIG={lazyLoadMargin:'200px',lazyLoadThreshold:0.01,enablePrefetch:true,prefetchDelay:2000,enablePerformanceLogging:false,performanceMetrics:['FCP','LCP','FID','CLS','TTFB']};function initLazyLoadImages(){if('loading' in HTMLImageElement.prototype){const images=document.querySelectorAll('img[data-src]');images.forEach(img=>{img.src=img.dataset.src;if(img.dataset.srcset){img.srcset=img.dataset.srcset;}img.removeAttribute('data-src');img.removeAttribute('data-srcset');});}else{const imageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const img=entry.target;if(img.dataset.src){img.src=img.dataset.src;}if(img.dataset.srcset){img.srcset=img.dataset.srcset;}img.classList.add('loaded');observer.unobserve(img);}});},{rootMargin:CONFIG.lazyLoadMargin,threshold:CONFIG.lazyLoadThreshold});const images=document.querySelectorAll('img[data-src]');images.forEach(img=> imageObserver.observe(img));}}function initLazyLoadIframes(){const iframeObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const iframe=entry.target;if(iframe.dataset.src){iframe.src=iframe.dataset.src;iframe.classList.add('loaded');observer.unobserve(iframe);}}});},{rootMargin:CONFIG.lazyLoadMargin,threshold:CONFIG.lazyLoadThreshold});const iframes=document.querySelectorAll('iframe[data-src]');iframes.forEach(iframe=> iframeObserver.observe(iframe));}function initPrefetching(){if(!CONFIG.enablePrefetch)return;setTimeout(()=>{const links=document.querySelectorAll('a[href^="/"],a[href^="./"],a[href^="../"]');const prefetchedUrls=new Set();links.forEach(link=>{const href=link.getAttribute('href');if(prefetchedUrls.has(href))return;if(href.startsWith('#'))return;const prefetchLink=document.createElement('link');prefetchLink.rel='prefetch';prefetchLink.href=href;prefetchLink.as='document';document.head.appendChild(prefetchLink);prefetchedUrls.add(href);});if(CONFIG.enablePerformanceLogging){console.log(`[Performance] Prefetched ${prefetchedUrls.size}pages`);}},CONFIG.prefetchDelay);}function initResourceHints(){const externalDomains=new Set();const images=document.querySelectorAll('img[src^="http"],img[data-src^="http"]');const scripts=document.querySelectorAll('script[src^="http"]');const stylesheets=document.querySelectorAll('link[href^="http"]');const iframes=document.querySelectorAll('iframe[src^="http"],iframe[data-src^="http"]');[...images,...scripts,...stylesheets,...iframes].forEach(element=>{const url=element.src || element.href || element.dataset.src;if(url){try{const domain=new URL(url).origin;externalDomains.add(domain);}catch(e){}}});externalDomains.forEach(domain=>{if(document.querySelector(`link[href="${domain}"]`))return;const prefetch=document.createElement('link');prefetch.rel='dns-prefetch';prefetch.href=domain;document.head.appendChild(prefetch);});if(CONFIG.enablePerformanceLogging){console.log(`[Performance] Added DNS prefetch for ${externalDomains.size}domains`);}}function initFontOptimization(){const fontLinks=document.querySelectorAll('link[href*="fonts.googleapis.com"]');fontLinks.forEach(link=>{if(!link.href.includes('display=swap')){link.href=link.href+(link.href.includes('?')? '&':'?')+'display=swap';}});}function initPerformanceMonitoring(){if(!CONFIG.enablePerformanceLogging)return;window.addEventListener('load',()=>{setTimeout(()=>{const perfData=performance.getEntriesByType('navigation')[0];const paintData=performance.getEntriesByType('paint');const metrics={TTFB:perfData.responseStart-perfData.requestStart,DCL:perfData.domContentLoadedEventEnd-perfData.domContentLoadedEventStart,Load:perfData.loadEventEnd-perfData.loadEventStart,FCP:paintData.find(p=> p.name==='first-contentful-paint')?.startTime || 0,DOMInteractive:perfData.domInteractive-perfData.fetchStart};console.table(metrics);const resources=performance.getEntriesByType('resource');const totalSize=resources.reduce((acc,r)=> acc+(r.transferSize || 0),0);console.log(`[Performance] Total transfer size:${(totalSize/1024).toFixed(2)}KB`);},0);});if('PerformanceObserver' in window){try{const lcpObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();const lastEntry=entries[entries.length-1];console.log(`[Performance] LCP:${lastEntry.renderTime || lastEntry.loadTime}ms`);});lcpObserver.observe({entryTypes:['largest-contentful-paint']});}catch(e){}try{const fidObserver=new PerformanceObserver((list)=>{const entries=list.getEntries();entries.forEach(entry=>{console.log(`[Performance] FID:${entry.processingStart-entry.startTime}ms`);});});fidObserver.observe({entryTypes:['first-input']});}catch(e){}try{let clsScore=0;const clsObserver=new PerformanceObserver((list)=>{for(const entry of list.getEntries()){if(!entry.hadRecentInput){clsScore+=entry.value;}}console.log(`[Performance] CLS:${clsScore.toFixed(4)}`);});clsObserver.observe({entryTypes:['layout-shift']});}catch(e){}}}function initThirdPartyScriptOptimization(){const scripts=document.querySelectorAll('script[data-async="true"]');scripts.forEach(script=>{if(!script.hasAttribute('async')&& !script.hasAttribute('defer')){script.setAttribute('async','true');}});}function initServiceWorker(){}function init(){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',runOptimizations);}else{runOptimizations();}}function runOptimizations(){initLazyLoadImages();initLazyLoadIframes();initResourceHints();initFontOptimization();initPrefetching();initThirdPartyScriptOptimization();initPerformanceMonitoring();}init();window.GeminiPerformance={config:CONFIG,enableLogging:()=>{CONFIG.enablePerformanceLogging=true;},disableLogging:()=>{CONFIG.enablePerformanceLogging=false;},getMetrics:()=> performance.getEntriesByType('navigation')[0]};})();