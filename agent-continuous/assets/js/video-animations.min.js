class CanvasSequence{constructor(t,e={}){this.canvas=t,this.context=this.canvas.getContext("2d"),this.frameCount=parseInt(t.dataset.frameCount)||e.frameCount||150,this.framePath=t.dataset.framePath||e.framePath||"frame-{index}.jpg",this.frameStart=parseInt(t.dataset.frameStart)||e.frameStart||0,this.scrollStart=e.scrollStart||0,this.scrollEnd=e.scrollEnd||1,this.images=[],this.currentFrame=0,this.isLoaded=!1,this.isPlaying=!1,this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.preloadImages()}resizeCanvas(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width*window.devicePixelRatio,this.canvas.height=t.height*window.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio),this.isLoaded&&this.images[this.currentFrame]&&this.drawFrame(this.currentFrame)}preloadImages(){const t=[];for(let e=0;e<this.frameCount;e++){const s=new Image,i=this.frameStart+e,a=String(i).padStart(4,"0");s.src=this.framePath.replace("{index}",a),t.push(new Promise((t,e)=>{s.onload=()=>t(s),s.onerror=()=>{console.warn(`Failed to load frame ${i}`),t(null)}})),this.images.push(s)}Promise.all(t).then(()=>{this.isLoaded=!0,this.drawFrame(0),this.startScrollAnimation()})}drawFrame(t){const e=this.images[t];if(!e||!e.complete)return;this.context.clearRect(0,0,this.canvas.width,this.canvas.height);const s=this.canvas.width/this.canvas.height;let i,a,r,n;e.width/e.height>s?(a=this.canvas.height,i=e.width*(a/e.height),r=(this.canvas.width-i)/2,n=0):(i=this.canvas.width,a=e.height*(i/e.width),r=0,n=(this.canvas.height-a)/2),this.context.drawImage(e,r,n,i,a)}startScrollAnimation(){let t=!1;const e=()=>{if(!this.isLoaded)return;const e=window.pageYOffset,s=document.documentElement.scrollHeight-window.innerHeight,i=(Math.min(Math.max(e/s,0),1)-this.scrollStart)/(this.scrollEnd-this.scrollStart),a=Math.min(Math.max(i,0),1),r=Math.min(this.frameCount-1,Math.floor(a*this.frameCount));r!==this.currentFrame&&(this.currentFrame=r,this.drawFrame(r)),t=!1};window.addEventListener("scroll",()=>{t||(requestAnimationFrame(e),t=!0)},{passive:!0}),e()}play(t=30,e=!1){if(this.isPlaying)return;this.isPlaying=!0;let s=0;const i=1e3/t,a=()=>{if(this.isPlaying){if(this.drawFrame(s),s++,s>=this.frameCount){if(!e)return void(this.isPlaying=!1);s=0}setTimeout(()=>requestAnimationFrame(a),i)}};a()}pause(){this.isPlaying=!1}reset(){this.currentFrame=0,this.drawFrame(0)}}class VideoPlayer{constructor(t){this.video=t,this.autoplay="true"===t.dataset.autoplay,this.loop="true"===t.dataset.loop,this.scrollPlay="true"===t.dataset.scrollPlay,this.init()}init(){this.loop&&(this.video.loop=!0),this.autoplay&&this.setupAutoplay(),this.scrollPlay&&this.setupScrollPlay(),this.video.addEventListener("loadeddata",()=>{this.video.classList.add("loaded")}),this.video.addEventListener("error",()=>{console.error("Video failed to load:",this.video.src),this.video.classList.add("error")})}setupAutoplay(){new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting?this.play():this.pause()})},{threshold:.5}).observe(this.video)}setupScrollPlay(){new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&this.syncToScroll()})},{threshold:[0,.25,.5,.75,1]}).observe(this.video)}syncToScroll(){let t=!1;const e=()=>{const e=this.video.getBoundingClientRect(),s=window.innerHeight,i=1-(e.top+e.height)/(s+e.height),a=Math.min(Math.max(i,0),1);this.video.currentTime=this.video.duration*a,t=!1};window.addEventListener("scroll",()=>{t||(requestAnimationFrame(e),t=!0)},{passive:!0})}play(){const t=this.video.play();void 0!==t&&t.catch(t=>{console.log("Video play prevented:",t)})}pause(){this.video.pause()}}class SVGAnimator{constructor(t){this.svg=t,this.paths=this.svg.querySelectorAll("path, circle, rect, line, polyline, polygon"),this.isAnimated=!1,this.init()}init(){this.paths.forEach(t=>{const e=t.getTotalLength?t.getTotalLength():0;e&&(t.style.strokeDasharray=e,t.style.strokeDashoffset=e)});new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&!this.isAnimated&&(this.animate(),this.isAnimated=!0)})},{threshold:.3}).observe(this.svg)}animate(t=1500){this.paths.forEach((e,s)=>{if(!(e.getTotalLength?e.getTotalLength():0))return;setTimeout(()=>{e.style.transition=`stroke-dashoffset ${t}ms ease-in-out`,e.style.strokeDashoffset="0"},100*s)})}reset(){this.paths.forEach(t=>{const e=t.getTotalLength?t.getTotalLength():0;e&&(t.style.transition="none",t.style.strokeDashoffset=e)}),this.isAnimated=!1}}class KeyframeAnimator{constructor(t,e){this.element=t,this.keyframes=e,this.duration=e[e.length-1].time,this.startTime=null,this.isPlaying=!1}play(){this.isPlaying||(this.isPlaying=!0,this.startTime=performance.now(),this.animate())}animate(){if(!this.isPlaying)return;const t=performance.now()-this.startTime,e=Math.min(t/this.duration,1);let s=this.keyframes[0],i=this.keyframes[this.keyframes.length-1];for(let e=0;e<this.keyframes.length-1;e++)if(t>=this.keyframes[e].time&&t<this.keyframes[e+1].time){s=this.keyframes[e],i=this.keyframes[e+1];break}const a=(t-s.time)/(i.time-s.time);this.interpolate(s.properties,i.properties,a),e<1?requestAnimationFrame(()=>this.animate()):this.isPlaying=!1}interpolate(t,e,s){Object.keys(t).forEach(i=>{const a=t[i],r=e[i];if("number"==typeof a){const t=a+(r-a)*s;this.element.style[i]=i.includes("opacity")?t:`${t}px`}})}pause(){this.isPlaying=!1}reset(){this.startTime=null,this.isPlaying=!1,this.interpolate(this.keyframes[0].properties,this.keyframes[0].properties,1)}}class TextMorph{constructor(t,e,s={}){this.element=t,this.texts=e,this.currentIndex=0,this.interval=s.interval||3e3,this.morphDuration=s.morphDuration||800,this.element.textContent=this.texts[0],this.startCycle()}startCycle(){setInterval(()=>{this.morphToNext()},this.interval)}morphToNext(){const t=(this.currentIndex+1)%this.texts.length,e=(this.texts[this.currentIndex],this.texts[t]);this.element.style.transition=`opacity ${this.morphDuration/2}ms ease-out`,this.element.style.opacity="0",setTimeout(()=>{this.element.textContent=e,this.element.style.opacity="1",this.currentIndex=t},this.morphDuration/2)}}class ScrollVideoScenes{constructor(t,e){this.video=t,this.scenes=e,this.currentScene=null,this.init()}init(){let t=!1;const e=()=>{const e=window.pageYOffset/(document.documentElement.scrollHeight-window.innerHeight);for(const t of this.scenes)if(e>=t.scrollStart&&e<=t.scrollEnd){const s=(e-t.scrollStart)/(t.scrollEnd-t.scrollStart),i=t.start+(t.end-t.start)*s;this.video.currentTime=i;break}t=!1};window.addEventListener("scroll",()=>{t||(requestAnimationFrame(e),t=!0)},{passive:!0}),this.video.pause()}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll("canvas[data-frame-count]").forEach(t=>{new CanvasSequence(t)}),document.querySelectorAll("video.apple-video").forEach(t=>{new VideoPlayer(t)}),document.querySelectorAll("svg[data-animate-draw]").forEach(t=>{new SVGAnimator(t)}),document.querySelectorAll("[data-text-morph]").forEach(t=>{const e=t.dataset.textMorph.split("|");new TextMorph(t,e)})}),"undefined"!=typeof module&&module.exports&&(module.exports={CanvasSequence:CanvasSequence,VideoPlayer:VideoPlayer,SVGAnimator:SVGAnimator,KeyframeAnimator:KeyframeAnimator,TextMorph:TextMorph,ScrollVideoScenes:ScrollVideoScenes});
//# sourceMappingURL=video-animations.min.js.map